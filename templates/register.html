<!DOCTYPE html>
<html lang="pt-BR"> 
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="/static/styles.css">
	<link rel="icon" type="image/x-icon" href="./static/menu-icon.jpg"> 
	<script src="/static/jquery-3.7.1.min.js"></script>
	<script src="/static/postcss.config.js"></script>
	<title>{{ .Title }}</title>  
</head>
<body>
<div class="container m-3">
	{{ template "register_content" . }}
	{{ template "footer" . }}
</div>
</body>
</html>

<script>

	// Execute when the document is fully loaded
	document.addEventListener('DOMContentLoaded', function() {
		// Focus on the name input field
		document.getElementById('name').focus();
		// Create a random Name for the user
		const randomNames = ['Ana', 'Bruno', 'Carla', 'Diego', 'Elisa', 'Fernando', 'Gabriela', 'Hugo', 'Isabela', 'João', 'Karla', 'Lucas', 'Mariana', 'Nicolas', 'Olivia', 'Pedro', 'Quésia', 'Rafael', 'Sofia', 'Tiago', 'Úrsula', 'Vitor', 'Yasmin', 'Zeca'];
		const randomName = randomNames[Math.floor(Math.random() * randomNames.length)];
		document.getElementById('name').value = randomName;
		// Create a random Email for the user based on the name
		const emailProviders = ['example.com', 'mail.com', 'test.com', 'demo.com'];
		const emailProvider = emailProviders[Math.floor(Math.random() * emailProviders.length)];
		const email = randomName
			.normalize('NFD')
			.replace(/[\u0300-\u036f]/g, '')
			.toLowerCase() + '@' + emailProvider;
		document.getElementById('email').value = email;
		// Create a fixed random password for the user
		const password = '123456';
		document.getElementById('password').value = password;
		document.getElementById('password_confirm').value = password;
		// Create a random Company Name in a group of 40 predefined options
		const companyNames = ['Cantina da Nena', 'Restaurante do Zé', 'Pizzaria Bella', 'Café Central', 'Bistrô Gourmet', 'Churrascaria Fogo de Chão', 'Hamburgueria do Chef', 'Sushi House', 'Padaria Pão Quente', 'Sorveteria Gelato', 'Lanchonete Fast Food', 'Cozinha Caseira', 'Bar do Amigo', 'Cervejaria Artesanal', 'Doceria Doce Sabor', 'Cafeteria Expresso', 'Restaurante Vegetariano', 'Food Truck Delícia', 'Buffet Festivo', 'Cozinha Internacional', 'Culinária Regional', 'Empório Gourmet', 'Mercado Natural', 'Loja de Conveniência', 'Supermercado Econômico', 'Hortifruti Frescor', 'Peixaria Maré Alta', 'Açougue Prime Cuts', 'Padaria Artesanal', 'Café da Manhã & Cia', 'Bistrô Romântico', 'Churrascaria Gaúcha', 'Hamburgueria Gourmet', 'Sushi Bar Premium', 'Pizzaria Napolitana', 'Sorveteria Tropical', 'Lanchonete Saudável', 'Cozinha Mediterrânea', 'Bar e Grill Sunset', 'Cervejaria Local Brew', 'Doceria Confeitaria Real'];
		const companyName = companyNames[Math.floor(Math.random() * companyNames.length)];
		document.getElementById('company_name').value = companyName + '_' + (Math.floor(Math.random() * 900) + 100);
		// Create a random phone number for the company
		const randomPhone = Math.floor(Math.random() * 9000000000) + 1000000000; // Generates a 10-digit number
		document.getElementById('company_phone').value = randomPhone;
		// Format the phone number
		document.getElementById('company_phone').value = formatPhone(document.getElementById('company_phone').value);
		// Create a random number for the company address
		const randomNumber = Math.floor(Math.random() * 900) + 100; // Generates a 3-digit number
		document.getElementById('company_number').value = randomNumber;
		// Create a random zip code for the company among a list of a 100 existing zip codes in Brazil
		const zipCode = getRandomBrazilianZip();
		document.getElementById('company_zip').value = zipCode;
		// Set focus in zip code input
		document.getElementById('company_zip').focus();
	});

	// Execute when button is clicked
	document.getElementById('register_button').addEventListener('click', function(event) {
		// Prevent the default form submission
		//event.preventDefault();
	});
	
	// Execute when company_phone input loses focus
	document.getElementById('company_phone').addEventListener('blur', function() {
		// Format the phone number
		this.value = formatPhone(this.value);
		const phone = this.value.replace(/\D/g, ''); // Remove non-digit characters
		if (phone.length === 10 || phone.length === 11) { // Check if phone has 10 or 11 digits
			// Fetch the phone information if needed
		} else {
			createToast('Número de telefone inválido. Deve conter 10 ou 11 dígitos.');
			this.value = '';
		}
	});

	// Execute every time company_phone input changes
	document.getElementById('company_phone').addEventListener('input', function() {
		let phone = this.value.replace(/\D/g, ''); // Remove non-digit characters
		if (phone.length > 11) phone = phone.slice(0, 11); // Limit to 11 digits
		// if backspace is pressed, do not format
		if (this.value.length > phone.length) {
			this.value = phone;
			return;
		}

		// Format the phone number as (XX) XXXXX-XXXX or (XX) XXXX-XXXX
		this.value = formatPhone(phone);
	});

	// Execute every time company_zip input changes
	document.getElementById('company_zip').addEventListener('input', function() {
		let zip = this.value.replace(/\D/g, ''); // Remove non-digit characters
		if (zip.length > 8) zip = zip.slice(0, 8); // Limit to 8 digits
		// if backspace is pressed, do not format
		if (this.value.length > zip.length) {
			this.value = zip;
			return;
		}
		// Format the zip code as XXXXX-XXX
		this.value = formatZip(zip);
	});

	// Execute when company_zip loses focus
	document.getElementById('company_zip').addEventListener('blur', function() {

		// Format the zip code
		this.value = formatZip(this.value);
		const zip = this.value.replace(/\D/g, ''); // Remove non-digit characters
		if (zip.length === 8) { // Check if zip has 8 digits
			fetch(`https://viacep.com.br/ws/${zip}/json/`)
				.then(response => response.json())
				.then(data => {
					if (!data.erro) {
						console.log(data);
						document.getElementById('company_state').value = data.uf || '';
						document.getElementById('company_city').value = data.localidade || '';
						document.getElementById('company_street').value = data.logradouro || '';
						document.getElementById('company_neighborhood').value = data.bairro || '';
						document.getElementById('company_number').focus();
					} else {
						alert('CEP não encontrado.');
					}
				})
				.catch(() => {
					alert('Erro ao buscar o CEP.');
				});
		} else {
			alert('CEP inválido. Deve conter 8 dígitos.');
			this.value = '';
			document.getElementById('company_state').value = '';
			document.getElementById('company_city').value = '';
		}
	});

	// execute when company_cnpj input loses focus
	/*
	document.getElementById('company_cnpj').addEventListener('blur', function() {
		const cnpj = this.value.replace(/\D/g, ''); // Remove non-digit characters
		if (cnpj.length === 14) { // Check if CNPJ has 14 digits
			fetch(`https://www.receitaws.com.br/v1/cnpj/${cnpj}`)
				.then(response => response.json())
				.then(data => {
					if (data.status === 'OK') {
						console.log(data);
						document.getElementById('company_name').value = data.nome || '';
						document.getElementById('company_zip').value = data.cep ? data.cep.replace(/\D/g, '') : '';
						document.getElementById('company_state').value = data.uf || '';
						document.getElementById('company_city').value = data.municipio || '';
					} else {
						alert('CNPJ não encontrado ou inválido.');
						document.getElementById('company_cnpj').focus();
					}
				})
				.catch(() => {
					alert('Erro ao buscar o CNPJ.');
				});
		} else {
			alert('CNPJ inválido. Deve conter 14 dígitos.');
			this.value = '';
			document.getElementById('company_name').value = '';
			document.getElementById('company_zip').value = '';
			document.getElementById('company_state').value = '';
			document.getElementById('company_city').value = '';
		}
	});
	*/

	// execute when company_name input loses focus
	document.getElementById('company_name').addEventListener('blur', function() {
		const companyName = this.value.trim();
		if (companyName.length === 0) {
			createToast('O nome da empresa é obrigatório.', 'error');
			this.classList.add('border-red-500');
			this.focus();
		} else {
			this.classList.remove('border-red-500');
		}
	});

	// Execute when confirm_password input loses focus
	document.getElementById('password_confirm').addEventListener('blur', function() {
		const password = document.getElementById('password').value;
		const confirmPassword = this.value;
		if (password !== confirmPassword) {
			createToast('As senhas não coincidem. Por favor, verifique.', 'error');
			this.classList.add('border-red-500');
			this.focus();
		} else {
			this.classList.remove('border-red-500');
		}
	});

	// Execute when password input loses focus
	document.getElementById('password').addEventListener('blur', function() {
		const password = this.value;
		if (password.length < 6) {
			createToast('A senha deve ter pelo menos 6 caracteres.', 'error');
			this.classList.add('border-red-500');
			this.focus();
		} else {
			this.classList.remove('border-red-500');
		}
	});

	// Execute when email input loses focus
	document.getElementById('email').addEventListener('blur', function() {
		const email = document.getElementById('email').value;
		const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Simple email regex pattern
		if (!emailPattern.test(email)) {
			alert('Por favor, insira um email válido.');
			document.getElementById('email').focus();
			return;
		}

		// Additional AJAX call to check if email is already registered can be added here
		console.log(email);
		fetch('/is-email-available', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/x-www-form-urlencoded',
			},
			body: new URLSearchParams({ email: email })
		}).then(response => response.json())
		.then(data => {
			console.log(data);
			if (data.exists) {
				alert('Este email já está cadastrado. Por favor, use outro email.');
				document.getElementById('email').value = '';
				document.getElementById('email').focus();
				document.getElementById('email').classList.add('border-red-500');
				document.getElementById('email').focus();
			}
			else {
				// Email is available
				document.getElementById('email').classList.remove('border-red-500');
			}
		}).catch(error => {
			console.error('Erro ao verificar o email:', error);
		});
	});

	// Execute when name input loses focus
	document.getElementById('name').addEventListener('blur', function() {
		const name = this.value.trim();
		if (name.length < 3) {
			createToast('O nome deve ter pelo menos 3 caracteres.', 'error');
			document.getElementById('name').classList.add('border-red-500');
			document.getElementById('name').focus();
		}
		else {
			document.getElementById('name').classList.remove('border-red-500');
		}
	});

	// Create toast notification at center of screen
	function createToast(message, type='info') {
		const toast = document.createElement('div');
		toast.className = `fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 px-4 py-2 rounded shadow-lg text-white text-center z-50 ${
			type === 'success' ? 'bg-green-500' :
			type === 'error' ? 'bg-red-500' :
			'bg-blue-500'
		}`;
		toast.textContent = message;
		document.body.appendChild(toast);
		setTimeout(() => {
			toast.remove();
		}, 3000);
	}

	function formatPhone(phone) {
		phone = phone.replace(/\D/g, ''); // Remove non-digit characters
		if (phone.length > 11) phone = phone.slice(0, 11); // Limit to 11 digits

		let formattedPhone = '';
		if (phone.length > 0) {
			formattedPhone += '(' + phone.slice(0, 2) + ') ';
			if (phone.length > 2) {
				if (phone.length === 11) {
					formattedPhone += phone.slice(2, 7) + '-' + phone.slice(7, 11);
				} else {
					formattedPhone += phone.slice(2, 6) + '-' + phone.slice(6, 10);
				}
			}
		}
		return formattedPhone;
	}

	function formatZip(zip) {
		zip = zip.replace(/\D/g, ''); // Remove non-digit characters
		if (zip.length > 8) zip = zip.slice(0, 8); // Limit to 8 digits

		let formattedZip = '';
		if (zip.length > 0) {
			formattedZip += zip.slice(0, 5);
			if (zip.length > 5) {
				formattedZip += '-' + zip.slice(5, 8);
			}
		}
		return formattedZip;
	}	

/**
 * Returns a random valid Brazilian ZIP code (CEP) from a predefined list.
 * This list is based on official CEP ranges for different regions of Brazil.
 *
 * @returns {string} A randomly selected Brazilian ZIP code in the format "XXXXX-XXX".
 */
function getRandomBrazilianZip() {
  const zipCodes = [
    // Região 0 - Grande São Paulo
    "01000-000", "01001-000", "01311-200", "02010-000", "02450-000", 
    "03100-000", "04001-000", "05001-000", "05410-000", "05713-000",
    "08000-000", "09010-000", "04538-132", "06020-190", "07110-000",
    "08290-000", "09725-160", "03350-005", "04101-000", "05407-000",

    // Região 1 - Interior de São Paulo
    "11000-000", "11015-000", "11700-000", "12010-000", "13000-000",
    "14000-000", "15000-000", "16010-000", "17000-000", "18000-000",
    "19000-000", "13214-360", "13214-660", "12240-000", "18550-000",
    "15090-000", "14400-000", "13087-000", "17500-000", "19800-000",

    // Região 2 - Rio de Janeiro e Espírito Santo
    "20000-000", "22000-000", "23000-000", "24000-000", "25000-000",
    "26000-000", "27000-000", "28000-000", "29000-000", "29100-000",
    "20231-010", "22450-000", "25805-000", "29165-000", "29300-000",
    "28905-000", "27310-000", "21031-030", "24800-000", "29200-000",

    // Região 3 - Minas Gerais
    "30000-000", "31000-000", "32000-000", "33000-000", "34000-000",
    "35000-000", "36000-000", "37000-000", "38000-000", "39000-000",
    "30180-000", "31710-000", "35500-000", "37550-000", "39400-000",
    "35700-000", "38400-000", "37950-000", "36010-000", "35160-000",

    // Região 4 - Bahia e Sergipe
    "40000-000", "41000-000", "42000-000", "43000-000", "44000-000",
    "45000-000", "46000-000", "47000-000", "49000-000",
    "40010-000", "41215-000", "44002-000", "49010-000", "42800-000",
    "45810-000", "47800-000", "49085-000", "44570-000", "49500-000",

    // Região 5 - Alagoas, Paraíba, Pernambuco, e Rio Grande do Norte
    "50000-000", "51000-000", "52000-000", "53000-000", "54000-000",
    "55000-000", "56000-000", "57000-000", "58000-000", "59000-000",
    "50710-000", "51111-000", "55290-000", "57030-000", "58010-000",
    "59012-000", "50670-000", "55120-000", "57300-000", "58400-000"
  ];

  const randomIndex = Math.floor(Math.random() * zipCodes.length);
  return zipCodes[randomIndex];
}

</script>   
