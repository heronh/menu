<!DOCTYPE html>
<html lang="pt-BR"> 

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="/static/styles.css">
	<link rel="icon" type="image/x-icon" href="./static/menu-icon.jpg"> 
	<script src="/static/jquery-3.7.1.min.js"></script>
	<script src="/static/postcss.config.js"></script>
	<title>{{ .Title }}</title>  
</head>

<body>
<div class="container m-3">
	{{ template "register_content" . }}
	{{ template "footer" . }}
</div>
</body>
</html>

<script>

	// Execute when the document is fully loaded
	document.addEventListener('DOMContentLoaded', function() {
		// Focus on the name input field
		document.getElementById('name').focus();
	});

	// Execute when company_phone input loses focus
	document.getElementById('company_phone').addEventListener('blur', function() {
		const phone = this.value.replace(/\D/g, ''); // Remove non-digit characters
		if (phone.length === 10 || phone.length === 11) { // Check if phone has 10 or 11 digits
			// Fetch the phone information if needed
		} else {
			createToast('Número de telefone inválido. Deve conter 10 ou 11 dígitos.');
			this.value = '';
		}
	});

	// Execute when company_ddd input loses focus
	document.getElementById('company_ddd').addEventListener('blur', function() {
		const ddd = this.value.replace(/\D/g, ''); // Remove non-digit characters
		if (ddd.length === 2) { // Check if DDD has 2 digits
			// Fetch the area code information if needed
		} else {
			createToast('DDD inválido. Deve conter 2 dígitos.');
			this.value = '';
		}
	});


	// Execute when company_zip loses focus
	document.getElementById('company_zip').addEventListener('blur', function() {
			const zip = this.value.replace(/\D/g, ''); // Remove non-digit characters
			if (zip.length === 8) { // Check if zip has 8 digits
				fetch(`https://viacep.com.br/ws/${zip}/json/`)
					.then(response => response.json())
					.then(data => {
						if (!data.erro) {
							console.log(data);
							document.getElementById('company_state').value = data.uf || '';
							document.getElementById('company_city').value = data.localidade || '';
							document.getElementById('company_address').value = data.logradouro || '';
							document.getElementById('company_neighborhood').value = data.bairro || '';
							document.getElementById('company_number').focus();
						} else {
							alert('CEP não encontrado.');
						}
					})
					.catch(() => {
						alert('Erro ao buscar o CEP.');
					});
			} else {
				alert('CEP inválido. Deve conter 8 dígitos.');
				this.value = '';
				document.getElementById('company_state').value = '';
				document.getElementById('company_city').value = '';
			}
	});

	// execute when company_cnpj input loses focus
	/*
	document.getElementById('company_cnpj').addEventListener('blur', function() {
		const cnpj = this.value.replace(/\D/g, ''); // Remove non-digit characters
		if (cnpj.length === 14) { // Check if CNPJ has 14 digits
			fetch(`https://www.receitaws.com.br/v1/cnpj/${cnpj}`)
				.then(response => response.json())
				.then(data => {
					if (data.status === 'OK') {
						console.log(data);
						document.getElementById('company_name').value = data.nome || '';
						document.getElementById('company_zip').value = data.cep ? data.cep.replace(/\D/g, '') : '';
						document.getElementById('company_state').value = data.uf || '';
						document.getElementById('company_city').value = data.municipio || '';
					} else {
						alert('CNPJ não encontrado ou inválido.');
						document.getElementById('company_cnpj').focus();
					}
				})
				.catch(() => {
					alert('Erro ao buscar o CNPJ.');
				});
		} else {
			alert('CNPJ inválido. Deve conter 14 dígitos.');
			this.value = '';
			document.getElementById('company_name').value = '';
			document.getElementById('company_zip').value = '';
			document.getElementById('company_state').value = '';
			document.getElementById('company_city').value = '';
		}
	});
	*/

	// execute when company_name input loses focus
	document.getElementById('company_name').addEventListener('blur', function() {
		const companyName = this.value.trim();
		if (companyName.length === 0) {
			createToast('O nome da empresa é obrigatório.', 'error');
			this.classList.add('border-red-500');
			this.focus();
		} else {
			this.classList.remove('border-red-500');
		}
	});

	// Execute when confirm_password input loses focus
	document.getElementById('password_confirm').addEventListener('blur', function() {
		const password = document.getElementById('password').value;
		const confirmPassword = this.value;
		if (password !== confirmPassword) {
			createToast('As senhas não coincidem. Por favor, verifique.', 'error');
			this.classList.add('border-red-500');
			this.focus();
		} else {
			this.classList.remove('border-red-500');
		}
	});

	// Execute when password input loses focus
	document.getElementById('password').addEventListener('blur', function() {
		const password = this.value;
		if (password.length < 6) {
			createToast('A senha deve ter pelo menos 6 caracteres.', 'error');
			this.classList.add('border-red-500');
			this.focus();
		} else {
			this.classList.remove('border-red-500');
		}
	});

	// Execute when email input loses focus
	document.getElementById('email').addEventListener('blur', function() {
		const email = document.getElementById('email').value;
		const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Simple email regex pattern
		if (!emailPattern.test(email)) {
			alert('Por favor, insira um email válido.');
			document.getElementById('email').focus();
			return;
		}

		// Additional AJAX call to check if email is already registered can be added here
		console.log(email);
		fetch('/is-email-available', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/x-www-form-urlencoded',
			},
			body: new URLSearchParams({ email: email })
		}).then(response => response.json())
		.then(data => {
			console.log(data);
			if (data.exists) {
				alert('Este email já está cadastrado. Por favor, use outro email.');
				document.getElementById('email').value = '';
				document.getElementById('email').focus();
				document.getElementById('email').classList.add('border-red-500');
				document.getElementById('email').focus();
			}
			else {
				// Email is available
				document.getElementById('email').classList.remove('border-red-500');
			}
		}).catch(error => {
			console.error('Erro ao verificar o email:', error);
		});
	});

	// Execute when name input loses focus
	document.getElementById('name').addEventListener('blur', function() {
		const name = this.value.trim();
		if (name.length < 3) {
			createToast('O nome deve ter pelo menos 3 caracteres.', 'error');
			document.getElementById('name').classList.add('border-red-500');
			document.getElementById('name').focus();
		}
		else {
			document.getElementById('name').classList.remove('border-red-500');
		}
	});

	// Create toast notification at center of screen
	function createToast(message, type='info') {
		const toast = document.createElement('div');
		toast.className = `fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 px-4 py-2 rounded shadow-lg text-white text-center z-50 ${
			type === 'success' ? 'bg-green-500' :
			type === 'error' ? 'bg-red-500' :
			'bg-blue-500'
		}`;
		toast.textContent = message;
		document.body.appendChild(toast);
		setTimeout(() => {
			toast.remove();
		}, 3000);
	}

</script>   
